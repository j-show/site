<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description" content="jShow's Home, share experiences and ideas"><meta name="keywords" content="jShow, jshow, Node.js, nodejs"><meta http-equiv="Expires" content="0"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Cache-control" content="no-cache"><meta http-equiv="Cache" content="no-cache"><title>Promise and asynchronous explanation - jShow's Home</title><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="https://www.googletagmanager.com/gtag/js?id=UA-141766789-1" async></script><script src="/images/global.js"></script><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/favicon.ico"></head><body><input id="navi" type="checkbox"><label class="navi-button light" for="navi">MENU</label><div class="main-navication"><div class="owner"><div class="ml30 slider" id="languager"><a class="selected en" href="javascript:void(0);" tag="en">English</a><div class="lang_block" style="display:none;"><a class="en" href="/en/20190619/2309/" tag="en">English</a><a class="zh" href="/zh/20190619/2309/" tag="zh">中文</a></div></div><a href="/en/index.html" target="_self"><i class="icon home"></i><span>Home</span></a><a href="https://github.com/j-show/jshow" target="_blank"><i class="icon github"></i><span>Github</span></a><a href="/tags/index-en.html" target="_self"><i class="icon tag"></i><span>Tags</span></a><a href="/categories/index-en.html" target="_self"><i class="icon category"></i><span>Categories</span></a><a href="/about/index-en.html" target="_self"><i class="icon author"></i><span>About</span></a></div></div><div class="wrapper" id="wrap"><div class="post-header"><div class="background"><img src="/images/post_background.jpg"></div><div class="post-title"><h1 class="title">Promise and asynchronous explanation</h1><ul class="meta"><li><i class="icon author"></i>jshow</li><li><i class="icon clock"></i><script>document.write(calcTime(1560926022608));</script></li><li><i class="icon calendar"></i>June 19, 2019</li></ul></div></div><div class="article-content" style="max-width:800px"><ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Origin"><span class="post-toc-number">1.</span> <span class="post-toc-text">Origin</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Infinite-callback"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">Infinite callback</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Deferred-object-Deferred"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">Deferred object (Deferred)</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Generator-Function-Generator"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">Generator Function(Generator)</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Promise"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">Promise</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#async-await"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">async/await</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Optimization"><span class="post-toc-number">2.</span> <span class="post-toc-text">Optimization</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#PS"><span class="post-toc-number">3.</span> <span class="post-toc-text">PS</span></a></li></ol>
<h1 id="Origin"><a href="#Origin" class="headerlink" title="Origin"></a>Origin</h1><p>Since js introduced the concept of asynchrony, many pioneers have come up with ways to make the code simpler, and we have a brief review of what it is.</p>
<h2 id="Infinite-callback"><a href="#Infinite-callback" class="headerlink" title="Infinite callback"></a><code>Infinite callback</code></h2><p>This is the earliest asynchronous solution, implemented by the infinite nesting of the callback function, not to confuse yourself, or to confuse the demand</p>
<blockquote>
<p>It is said that the KPI of the code farmer is very easy at that time, and a few hundred lines of code can be piled up with one demand, and the code redundancy can be seen.</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Test</span>(<span class="params">num,callback</span>)</span>&#123;</span><br><span class="line">	setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		callback()</span><br><span class="line">	&#125;, num * <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Test(<span class="number">10</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"10 seconds after"</span>);</span><br><span class="line"></span><br><span class="line">	Test(<span class="number">2</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">"12 seconds after"</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>-</p>
<h2 id="Deferred-object-Deferred"><a href="#Deferred-object-Deferred" class="headerlink" title="Deferred object (Deferred)"></a><code>Deferred object (Deferred)</code></h2><p>This is the delayed object scheme first proposed by the <code>jQuery</code> library.</p>
<blockquote>
<p>Delay objects are roughly divided into <code>done&#39;,</code>fail’, and ‘always’ states, which are executed in different states through a callback function.</p>
</blockquote>
<p>Allows the same state to be registered at the same time. The done and fail states are mutually exclusive, and only one state is allowed to be triggered.<br>Even if the state is triggered first, after registering the function, it will receive the corresponding trigger.</p>
<p>Special note: all state callback functions are executed synchronously.</p>
<blockquote>
<p>The essence is to pass the state and establish a list of callback functions, also belongs to the callback function category, but the code is very comfortable to look at.</p>
</blockquote>
<blockquote>
<p>jQuery’s lag object was once normalized to make the messy callback function normal, which is a clear stream! The asynchronous mechanism in jShow draws on a part of the operation form and is a tribute to the predecessors.</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Test</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> dtd = $.Deferred();</span><br><span class="line"></span><br><span class="line">	setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		dtd.resolve(<span class="string">"n seconds after"</span>);</span><br><span class="line">	&#125;, num * <span class="number">1000</span>);</span><br><span class="line">		</span><br><span class="line">	dtd.promise();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Test()</span><br><span class="line">	.done(<span class="function"><span class="keyword">function</span>(<span class="params">val</span>)</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(val, <span class="number">1</span>); <span class="comment">// n seconds after 1</span></span><br><span class="line">	&#125;)</span><br><span class="line">	.done(<span class="function"><span class="keyword">function</span>(<span class="params">val</span>)</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(val, <span class="number">2</span>); <span class="comment">// n seconds after 2</span></span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>

<p>-</p>
<h2 id="Generator-Function-Generator"><a href="#Generator-Function-Generator" class="headerlink" title="Generator Function(Generator)"></a><code>Generator Function(Generator)</code></h2><p>This is an asynchronous solution generated after the ES2015 standard. It builds a function block that can be executed step by step, and the user can choose when to perform the next step.</p>
<blockquote>
<p>Step-by-step implementation, a bit like step-by-step tracking in a debugging environment.</p>
</blockquote>
<blockquote>
<p>The generator itself is not meant to solve asynchronous problems, but the famous <code>tj</code> writes a <code>co</code> library, which allows the generator function to run automatically, and the two combinations make it fully usable for writing asynchronous functions.</p>
</blockquote>
<blockquote>
<p>But because the generator is very raw coding and complex logic, it is hard to like, so there are very few users.</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">Test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">// do something</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">co(<span class="function"><span class="keyword">function</span>* (<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">let</span> d;</span><br><span class="line">	</span><br><span class="line">	d = <span class="keyword">yield</span> Test();</span><br><span class="line">	Console.log(d);</span><br><span class="line">	</span><br><span class="line">	d = <span class="keyword">yield</span> Test();</span><br><span class="line">	<span class="built_in">console</span>.log(d);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>The generator function introduces a special syntax structure such as <code>function*</code> and <code>yield</code>, and <code>yield</code> must be valid inside <code>function*</code>.</p>
<p>-</p>
<h2 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a><code>Promise</code></h2><p>It may be that the generator is too unacceptable. The ES6 standard has a promise. It can be said that it is the official version of Deferred. The final state is determined by the <code>resovle</code> and <code>reject</code> in the parameters.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Test</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</span><br><span class="line">		setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			resovle(<span class="string">"n seconds after"</span>);</span><br><span class="line">		&#125;, num * <span class="number">1000</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Test(<span class="number">10</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">val</span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(val); <span class="comment">// n secord after</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Promise still needs to use a code structure similar to the callback function.</p>
<p>The <code>then</code>/<code>catch</code> function is similar to the callback registration of a lingering object, but returns a new Promise object each time it is called.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">// do something</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = a.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.is(a, b)) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>There is no doubt that everyone based on the understanding of the promise is somewhat different, which also caused the realization of the promise on the <code>npm</code> platform, which makes people feel a bit confused.</p>
</blockquote>
<blockquote>
<p>The reason for this is not to say that there is a problem with the code of the promises in the various libraries, but for the understanding of asynchronous and the use of promises, so here is not a separate description for the promise, but a description with async/await.</p>
</blockquote>
<p><strong><em>Based on the asynchronous mechanism and understanding of jShow, we think that it is meaningless to discuss the promise separately</em></strong></p>
<p>-</p>
<h2 id="async-await"><a href="#async-await" class="headerlink" title="async/await"></a><code>async/await</code></h2><p>ES7 proposed a formal asynchronous solution and introduced the <code>async/await</code> syntax structure.</p>
<blockquote>
<p>Similar to the generator’s <code>function*</code> and <code>yield</code> syntax, the await keyword is only allowed inside the async function.</p>
</blockquote>
<blockquote>
<p>Regardless of the normal function (function), asynchronous function (async function), as long as the function return value is a promise object, the use of await will automatically perform asynchronous operations, the difference is that the await keyword is not allowed inside ordinary functions.</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Test</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</span><br><span class="line">		setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			<span class="keyword">if</span> (num === <span class="number">10</span>) resovle(<span class="string">"n seconds after"</span>);</span><br><span class="line">			<span class="keyword">else</span> reject(<span class="string">"return reject"</span>);</span><br><span class="line">		&#125;, num * <span class="number">1000</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="keyword">let</span> v1 = <span class="keyword">await</span> Test(<span class="number">10</span>);</span><br><span class="line">		<span class="built_in">console</span>.log(val); <span class="comment">// n secord after</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(e); <span class="comment">// return reject</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">let</span> v2 = <span class="keyword">await</span> Test(<span class="number">5</span>);</span><br><span class="line">	<span class="built_in">console</span>.log(val) <span class="comment">// n secord after</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p>Here are three important points:</p>
<ol>
<li><p>The await keyword must be used inside the async function, otherwise it will cause compilation errors.</p>
</li>
<li><p>The await keyword can be understood as a built-in function</p>
<blockquote>
<p>await Test(10) can be understood as await(Test(10))</p>
</blockquote>
<blockquote>
<p>await handles the return value of Test(10). When the return value is a promise object, it will wait for the resovle state result asynchronously. When the return value is other types, it will get the return value directly.</p>
</blockquote>
<blockquote>
<p>await is asynchronously executed, does not cause code blocking, similar to the transfer of control of thread switching</p>
</blockquote>
</li>
<li><p>await can’t handle the reject state of the promise object. Of course, when the reject state is triggered, an exception will be thrown. It needs to be processed with try…catch.</p>
</li>
</ol>
<p><strong>ES6 Promise provides a very simple state machine implementation for asynchronous single-step operations. But it can’t satisfy the entire asynchronous process, and the chained syntax is just an ES6 version of the <code>infinite callback</code>.</strong></p>
<p><strong>ES7’s async solves the control of asynchronous processes very well. Promises handle state control, async serial asynchronous process, the asynchronous process is written in synchronous code, the code will be very concise.</strong></p>
<blockquote>
<p>The only problem, even if the interpreter is required to support the async syntax.</p>
</blockquote>
<blockquote>
<p>If you give up the IE8- Webbrowser, it doesn’t seem to be a big deal.</p>
</blockquote>
<h1 id="Optimization"><a href="#Optimization" class="headerlink" title="Optimization"></a>Optimization</h1><p>jShow is aimed at asynchronous processes, with its own optimization scheme, its original intention is to make the code more concise and more readable.</p>
<p>Through the above brief description of <a href="#async-await">async/await</a>, some considerations for asynchronous programming should be clear. From this we can easily find that async is very simple in process control, but it is a bit complicated in terms of compatibility and Promise.</p>
<ul>
<li><p>basic</p>
<p>  For general use, jShow extends this to Promise, making it simpler to use.</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">Test</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">const</span> dtd = jShow.Deferred(<span class="literal">true</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">let</span> rs = <span class="keyword">await</span> Test(<span class="number">10</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">console</span>.log(rs); <span class="comment">// ok;</span></span><br><span class="line">	</span><br><span class="line">	setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (num === <span class="number">10</span>) dtd.resolve(<span class="string">"ok"</span>);</span><br><span class="line">		<span class="keyword">else</span> dtd.reject(<span class="string">"error"</span>, num);</span><br><span class="line">	&#125;, num * <span class="number">1000</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> dtd.promise();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> ()=&gt;&#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="keyword">await</span> Test(<span class="number">5</span>);</span><br><span class="line">	&#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p>  -</p>
<p>  By extending the Promise object, the promise object is confirmed in advance, and the state is set when needed. This completely breaks the form that the promise object must be wrapped in a function, making the encoding more free.</p>
<blockquote>
<p>jShow’s Deferred allows binding of ‘final function’, <code>final function</code> allows execution after all asynchronous bind events have been executed</p>
</blockquote>
<blockquote>
<p>jShow’s Deferred has two types: simple mode and complex mode. The simple mode is an extension to the Promise object. The complex mode is based on the simple mode.</p>
</blockquote>
<p>  <strong><em>We recommend that all await operations be reported by try…catch to ensure that the reject state can be hit and processed</em></strong></p>
</li>
<li><p>Force internal functions for normal functions</p>
<p>  In actual development, we often use an asynchronous operation on the platform, which must be used inside ordinary functions. The asynchronous mechanism of jShow can be called in the following ways without changing the original asynchronous function.</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">Test</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">const</span> dtd = jShow.Deferred(<span class="literal">true</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">let</span> rs = <span class="keyword">await</span> Test(<span class="number">10</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">console</span>.log(rs); <span class="comment">// ok;</span></span><br><span class="line">	</span><br><span class="line">	setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (num === <span class="number">10</span>) dtd.resolve(<span class="string">"ok"</span>);</span><br><span class="line">		<span class="keyword">else</span> dtd.reject(<span class="string">"error"</span>, num);</span><br><span class="line">	&#125;, num * <span class="number">1000</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> dtd.promise();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Test(<span class="number">5</span>)</span><br><span class="line">	.done(<span class="function"><span class="params">val</span>=&gt;</span>&#123;</span><br><span class="line">	&#125;)</span><br><span class="line">	.fail(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Conversion</p>
<p>  Because you need to use a function written by someone else, you are not sure about the other party’s operation form, you can simply use the conversion function package to achieve the same purpose.</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">Test1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">// generator function, do something</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> test1 = jShow.Async(Test1);</span><br><span class="line"><span class="comment">//test1 is async function</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Test2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">//normal function, do something</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> test2 = jShow.Done(Test2);</span><br><span class="line"><span class="comment">//test2 is async function</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="PS"><a href="#PS" class="headerlink" title="PS"></a>PS</h1><p>Think about asynchronous programming or even the entire node.js. The reason why people think that learning costs are high, the code form is very different. It is entirely due to the responsibility of ECMAScript, there is no corresponding guidance in the process of ES version iteration. Even the official instructions are vague, causing most people to have a very large deviation from understanding.</p>
<p>Before reading other people’s code, I found that most of them are caught in the Promise problem. It is not that he understands asynchronous. He usually uses the promise state machine to solve asynchronous process control, which leads to code redundancy and process. Hard to accept. Perhaps the ES7 at the time of coding has not appeared yet, but it may appear, but the author has not had time to learn, even considering compatibility, which has created such a situation, but it is undeniable that this leaves a huge hidden danger and mistake for the user. guide. Let more and more people receive the wrong information.</p>
</div><div class="article-meta" style="max-width:800px"><div class="tags"><i class="icon tag"></i><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/en/tags/explain">explain</a></li></ul></div><div class="categories"><i class="icon category"></i><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/en/categories/jShow">jShow</a></li></ul></div></div><ul class="navication"><li class="home"><a href="/"><i class="icon home"></i></a></li><li><a href="/en/20190612/1319/"><i class="icon arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/j-show/jshow" title="Github" target="_blank"><i class="icon github"></i></a></li><li><a href="https://twitter.com/jShow_OS" title="Twitter" target="_blank"><i class="icon twitter"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2019 jShow's Home<br><script type="text/javascript">analytics_google("UA-141766789-1")</script><script type="text/javascript">analytics_cnzz("1277700064")</script><small>POWER BY&nbsp;<a href="https://hexo.io" target="_blank">HEXO</a></small>&nbsp;|&nbsp;<small>THEME BY&nbsp;<a href="https://github.com/BoizZ/hexo-theme-laughing" target="_blank">LAUGHING</a></small></p></div></div></div><div id="dialog" style="display:none;"></div><script type="text/javascript">$(function () { $("#wrap").addClass("done"); $("#languager").Languager(); });</script></body></html>